---
title: "5243_proj1_sj2854"
author: "Shichao Jia UNI:sj2854"
date: "2018Äê9ÔÂ19ÈÕ"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
```
# what's make your girlfriend/wife happy in certain age range

### Step 0 - Load all the required libraries
library(tidyverse)  
library(tidytext)  
library(DT)  
library(scales)  
library(wordcloud2)  
library(gridExtra)  
library(ngram)  
library(shiny)   
```{r results='asis', echo=T, include=F,}

# install.packages('tidyverse')
# install.packages('tidytext')
# install.packages('DT')
# install.packages('scales')
# install.packages('wordcloud2')
# install.packages('gridExtra')
# install.packages('ngram')
# install.packages('shiny')
library(tidyverse)
library(tidytext)
library(DT)
library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)
library(shiny) 
```

### Step 1 - Load the processed text data along with demographic information on contributors

We use the processed data for our analysis and combine it with the demographic information available.

```{r load data, warning=FALSE, message=FALSE}
hm_data <- read_csv("../output/processed_moments.csv")
urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read_csv(urlfile)
# scrap all the NA
head(demo_data[!complete.cases(demo_data),])
demo_data_nNA <- na.omit(demo_data)
demo_data_nNA[!complete.cases(demo_data_nNA),]

```




### Combine both the data sets and keep the required columns for analysis

We select a subset of the data that satisfies specific row conditions.

```{r combining data, warning=FALSE, message=FALSE}


hm_data <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         marital, 
         parenthood,
         reflection_period,
         age, 
         country, 
         ground_truth_category, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(marital %in% c("single", "married")) %>%
  filter(parenthood %in% c("n", "y")) %>%
  filter(reflection_period %in% c("24h", "3m")) %>%
  mutate(reflection_period = fct_recode(reflection_period, 
                                        months_3 = "3m", hours_24 = "24h"))


```

we analyst the data that what is the certain age we want to persue
```{r}
# turn age to number
demo_data_nNA$age <- suppressWarnings(as.numeric(as.character(demo_data_nNA$age)))

tab0 <- table(demo_data_nNA$parenthood)
barplot(tab0,
        names.arg=rownames(tab0),
        col=c("beige","orange"),
        xlab="parent or non parent")


# see the distribution of marital stat
tab1 <- table(demo_data_nNA$marital)
barplot(tab1,
        names.arg=rownames(tab1),
        col=c("beige","orange","blue"),
        xlab="marital statue")
```
#### marital  
```{r}

############################################
#single
demo_data_nNA_single <- demo_data_nNA[ which(demo_data_nNA$gender=='f' 
& demo_data_nNA$marital == 'single'), ]
hist(demo_data_nNA_single$age, breaks = 100)
summary(demo_data_nNA_single$age)
# select age between 1 Qu to 3 Qu
demo_data_single <- demo_data_nNA_single[ which(demo_data_nNA_single$age >= 23 & demo_data_nNA_single$age <= 32), ]
hist(demo_data_single$age)
##################################################
#married
demo_data_nNA_married <- demo_data_nNA[ which(demo_data_nNA$gender=='f' 
& demo_data_nNA$marital == 'married'), ]
hist(demo_data_nNA_married$age, breaks = 100)
summary(demo_data_nNA_married$age)
# select age between 1 Qu to 3 Qu
demo_data_married <- demo_data_nNA_married[ which(demo_data_nNA_married$age >= 29 & demo_data_nNA_married$age <= 42), ]
hist(demo_data_married$age)
```

#### parenthood  
```{r}
############################################
#non parent  
demo_data_nNA_npar <- demo_data_nNA[ which(demo_data_nNA$gender=='f' 
& demo_data_nNA$parenthood == 'n'), ]
hist(demo_data_nNA_npar$age, breaks = 100)
summary(demo_data_nNA_npar$age)
# select age between 1 Qu to 3 Qu
demo_data_npar <- demo_data_nNA_npar[ which(demo_data_nNA_npar$age >= 24 & demo_data_nNA_npar$age <= 33), ]
hist(demo_data_npar$age)
##################################################
# parent  
demo_data_nNA_par <- demo_data_nNA[ which(demo_data_nNA$gender=='f' 
& demo_data_nNA$parenthood == 'y'), ]
hist(demo_data_nNA_par$age, breaks = 100)
summary(demo_data_nNA_par$age)
# select age between 1 Qu to 3 Qu
demo_data_par <- demo_data_nNA_par[ which(demo_data_nNA_par$age >= 30 & demo_data_nNA_par$age <= 45), ]
hist(demo_data_par$age)

```
  
# subset the data  
```{r}
#subset of singles in certain age range
demo_data_single_wid <- demo_data_single$wid
hm_data_single <- hm_data[hm_data$wid %in% demo_data_single_wid, ]
#subset of married in certain age range
demo_data_married_wid <- demo_data_married$wid
hm_data_married <- hm_data[hm_data$wid %in% demo_data_married_wid, ]
#subset of people who do not have children in certain age range
demo_data_npar_wid <- demo_data_npar$wid
hm_data_npar <- hm_data[hm_data$wid %in% demo_data_npar_wid, ]
#subset of people who have children in certain age range
demo_data_par_wid <- demo_data_par$wid
hm_data_par <- hm_data[hm_data$wid %in% demo_data_par_wid, ]



```

-------------------------------------------
```{r}
# datatable(hm_data_nNA_age)
```
 
```{r warning=FALSE, echo=TRUE, message=FALSE}
### subset of singles  
#### Create a bag of words using the text data 
bag_of_words_single <-  hm_data_single %>%
  unnest_tokens(word, text)

word_count_single <- bag_of_words_single %>%
  count(word, sort = TRUE)
```



```{r message=FALSE, warning=FALSE}
### Create bigrams using the text data  
hm_bigrams_single <- hm_data_single %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_single <- hm_bigrams_single %>%
  count(bigram, sort = TRUE)
```
################################################

```{r warning=FALSE, message=FALSE}
### subset of married  
#### Create a bag of words using the text data  

bag_of_words_married <-  hm_data_married %>%
  unnest_tokens(word, text)

word_count_married <- bag_of_words_married %>%
  count(word, sort = TRUE)
```

 

```{r message=FALSE, warning=FALSE}
### Create bigrams using the text data 
hm_bigrams_married <- hm_data_married %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_married <- hm_bigrams_married %>%
  count(bigram, sort = TRUE)
```
################################################


```{r warning=FALSE, message=FALSE}
###subset of people who do not have children  
#### Create a bag of words using the text data  
bag_of_words_npar <-  hm_data_npar %>%
  unnest_tokens(word, text)

word_count_npar <- bag_of_words_npar %>%
  count(word, sort = TRUE)
```

 

```{r message=FALSE, warning=FALSE}
### Create bigrams using the text data 
hm_bigrams_npar <- hm_data_npar %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_npar <- hm_bigrams_npar %>%
  count(bigram, sort = TRUE)
```
################################################


```{r warning=FALSE, message=FALSE}
###subset of people who have children  
#### Create a bag of words using the text data  
bag_of_words_par <-  hm_data_par %>%
  unnest_tokens(word, text)

word_count_par <- bag_of_words_par %>%
  count(word, sort = TRUE)
```



```{r message=FALSE, warning=FALSE}
### Create bigrams using the text data  
hm_bigrams_par <- hm_data_par %>%
  filter(count != 1) %>%
  unnest_tokens(bigram, text, token = "ngrams", n = 2)

bigram_counts_par <- hm_bigrams_par %>%
  count(bigram, sort = TRUE)
```
################################################
  
# have vs not have children
```{r}

p<-ggplot(data=head(bigram_counts_par,20), aes(x=reorder(bigram, n), y=n)) +
  ggtitle("people who have children")+
  geom_bar(stat="identity")+
  coord_flip()
p
p<-ggplot(data=head(bigram_counts_npar,20), aes(x=reorder(bigram, n), y=n)) +
  ggtitle("people who do not have children")+
  geom_bar(stat="identity")+
  coord_flip()
p
```


```{r}
#single vs married
#married
p<-ggplot(data=head(bigram_counts_married,20), aes(x=reorder(bigram, n), y=n)) +
  ggtitle("people who married")+
  geom_bar(stat="identity")+
  coord_flip()
p
#single
p<-ggplot(data=head(bigram_counts_single,20), aes(x=reorder(bigram, n), y=n)) +
  ggtitle("people who are still single")+
  geom_bar(stat="identity")+
  coord_flip()
p

```


### lastly using HappyDB_rShiny.rmd to produce the gragh of word cloud













